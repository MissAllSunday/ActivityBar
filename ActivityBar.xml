<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">

<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
	<id>Suki:ActivityBar</id>
	<version>1.2</version>

	<file name="$sourcedir/Display.php">
		<operation>
			<search position="replace"><![CDATA[// Is this user the message author?]]></search>
			<add><![CDATA[
	// ActivityBar mod
	if (ActivityBar::run()->setting('enable') && ActivityBar::run()->setting('show_in_posts'))
	{
		$output['member']['custom_fields']['-1'] = ActivityBar::run()->activityDisplay($output['member']['id']);
		ksort($output['member']['custom_fields']);
	}
	// ActivityBar mod end

	// Is this user the message author?]]></add>
		</operation>
	</file>

	<file name="$sourcedir/Profile.php">
		<operation>
			<search position="replace"><![CDATA['value' => $value,
		);
	}
	$smcFunc['db_free_result']($request);]]></search>
			<add><![CDATA['value' => $value,
		);
	}
	$smcFunc['db_free_result']($request);

	// ActivityBar mod
	if (ActivityBar::run()->setting('enable') && ActivityBar::run()->setting('show_in_profile'))
		ActivityBar::run()->activityProfile($memID);
	// ActivityBar mod end
]]></add>
		</operation>
	</file>

	<file name="$sourcedir/Subs-Post.php">
		<operation>
			<search position="replace"><![CDATA[updateMemberData($posterOptions['id'], array('posts' => '+'));]]></search>
			<add><![CDATA[updateMemberData($posterOptions['id'], array('posts' => '+'));

		// ActivityBar mod
		if (ActivityBar::run()->setting('enable'))
			cache_put_data('ActivityBar_' . $user_info['id'], null, 30);
		// ActivityBar mod end
]]></add>
		</operation>
	</file>
</modification>
