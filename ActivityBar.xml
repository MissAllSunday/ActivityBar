<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">

<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
	<id>Suki:Activity_Bar</id>
	<version>1.1</version>

	<file name="$sourcedir/Display.php">
		<operation>
			<search position="before"><![CDATA['can_see_ip' => allowedTo('moderate_forum') || ($message['id_member'] == $user_info['id'] && !empty($user_info['id'])),]]></search>
			<add><![CDATA[
			'Activity_Bar' => Activity_Bar($message['id_member']),]]></add>
		</operation>
	</file>

	<file name="$sourcedir/Profile-View.php">
		<operation>
			<search position="before"><![CDATA[	$context['can_view_warning'] = in_array('w', $context['admin_features']) && (allowedTo('issue_warning') && !$context['user']['is_owner']) || (!empty($modSettings['warning_show']) && ($modSettings['warning_show'] > 1 || $context['user']['is_owner']));]]></search>
			<add><![CDATA[$context['Activity_Bar'] = Activity_Bar($memID);]]></add>
		</operation>
	</file>

	<file name="$sourcedir/Who.php">
	<operation>
			<search position="replace"><![CDATA['mods' => array(]]></search>
			<add><![CDATA[		'mods' => array(
			Activity_Bar_Who(),]]></add>
		</operation>
	</file>
	
	<file name="$sourcedir/Load.php">
	<operation>
			<search position="replace"><![CDATA[// This determines the server... not used in many places, except for login fixing.]]></search>
			<add><![CDATA[
	/* Activity Bar Mod */
	$context['html_headers'] .= Activity_Bar_css();

	// This determines the server... not used in many places, except for login fixing.]]></add>
		</operation>
	</file>

	<file name="$themedir/Profile.template.php">
		<operation>
			<search position="after"><![CDATA[if (!empty($modSettings['userLanguage']) && !empty($context['member']['language']))]]></search>
			<add><![CDATA[
	/* Activity Bar Mod */
	if(!empty($modSettings['Activity_Bar_enable']) && !empty($modSettings['Activity_Bar_show_in_profile']) && !empty($context['Activity_Bar']))
		echo '
				<dt>', !empty($modSettings['Activity_Bar_label']) ? $modSettings['Activity_Bar_label'] : $txt['Activity_Bar_standardlabel'], ':</dt>
				<dd><div class="activity_holder" style="width: ', !empty($modSettings['Activity_Bar_max_width']) ? $modSettings['Activity_Bar_max_width'] : 139, 'px;"><div class="activity_bar" style="width: ', $context['Activity_Bar']['width'], 'px;"><div class="activity_percentage smalltext">', $context['Activity_Bar']['percentage'], '%</div></div></div></dd>';

]]></add>
		</operation>
	</file>
	
	<file name="$themedir/Display.template.php">
		<operation>
			<search position="replace"><![CDATA[// Is karma display enabled?  Total or +/-?]]></search>
			<add><![CDATA[
			/* Activity Bar Mod */
			if(!empty($modSettings['Activity_Bar_enable']) && !empty($modSettings['Activity_Bar_show_in_posts']) && !empty($message['Activity_Bar']))
				echo '
						<li class="activity_li">', !empty($modSettings['Activity_Bar_label']) ? $modSettings['Activity_Bar_label'] : $txt['Activity_Bar_standardlabel'], ':
						<div class="activity_holder" style="width: ', !empty($modSettings['Activity_Bar_max_width']) ? $modSettings['Activity_Bar_max_width'] : 139, 'px;"><div class="activity_bar" style="width: ', $message['Activity_Bar']['width'], 'px;"><div class="activity_percentage">', $message['Activity_Bar']['percentage'], '%</div></div></div></li>';
			/* Activity Bar Mod */

			// Is karma display enabled?  Total or +/-?]]></add>
		</operation>
	</file>

</modification>